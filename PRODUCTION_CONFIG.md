# 🔒 生产环境配置（严禁修改）

## ⚠️ 重要警告

**本文档记录的是生产环境的关键配置信息。任何未经授权的修改都可能导致网站数据丢失或服务中断！**

## 数据库配置

### ✅ 正确的生产数据库配置

```
DATABASE_URL=mysql://4UghFjJ7qjGhgt4.root:RJpUZUxMkdhEv2JU@gateway01.us-west-2.prod.aws.tidbcloud.com:4000/rowell_hplc?ssl=true
```

**关键参数：**
- **数据库名称**：`rowell_hplc`
- **区域**：`us-west-2`（美国俄勒冈）
- **主机**：`gateway01.us-west-2.prod.aws.tidbcloud.com`
- **端口**：`4000`
- **SSL**：`true`

**数据内容：**
- 产品数据：约1929个产品
- 用户数据：生产环境用户
- 询价数据：客户询价记录

### ❌ 错误配置（请勿使用）

以下配置是测试/开发环境，**绝对不能**用于生产环境：

```
# 错误示例1：rowell_workflow数据库
DATABASE_URL=mysql://...@gateway01.ap-northeast-1.prod.aws.tidbcloud.com:4000/rowell_workflow?ssl=true

# 错误示例2：其他测试数据库
DATABASE_URL=mysql://...@gateway01.ap-northeast-1.prod.aws.tidbcloud.com:4000/rowell_test?ssl=true
```

## 配置验证

### 自动验证机制

服务器启动时会自动验证数据库配置：

1. **数据库名称检查**：确保连接到 `rowell_hplc`
2. **产品数量检查**：确保产品数量 > 1000
3. **如果验证失败**：服务器将拒绝启动并输出错误信息

### 手动验证方法

如果怀疑配置错误，可以通过以下方式验证：

```bash
# 检查产品数量
curl "https://www.rowellhplc.com/api/trpc/product.list?batch=1&input=%7B%220%22%3A%7B%7D%7D"

# 正常情况下应该返回约1929个产品
```

## 修改流程

### 如果必须修改配置

1. **记录当前配置**：在修改前，完整记录当前的DATABASE_URL
2. **通知相关人员**：通知技术负责人和项目经理
3. **创建备份**：确保数据库有最新备份
4. **测试验证**：在测试环境先验证新配置
5. **监控部署**：修改后密切监控服务状态和数据完整性

### 紧急回滚

如果发现配置错误导致数据丢失：

1. **立即停止服务**
2. **恢复正确配置**：使用本文档中的正确配置
3. **重新部署**
4. **验证数据恢复**

## 环境说明

### 生产环境
- **服务名称**：rowell-website-prod
- **域名**：www.rowellhplc.com
- **数据库**：rowell_hplc
- **用途**：对外提供服务的正式环境

### 测试环境（如需创建）
- **服务名称**：rowell-website-test（待创建）
- **域名**：test.rowellhplc.com（待配置）
- **数据库**：rowell_test（待创建）
- **用途**：功能测试和开发验证

## 历史问题记录

### 2026-01-29：数据库配置错误事件

**问题**：DATABASE_URL被错误修改为rowell_workflow数据库，导致产品数据丢失

**影响**：网站显示0个产品，所有产品相关功能不可用

**原因**：缺乏配置验证和锁定机制

**解决**：恢复正确配置，添加自动验证机制

**预防措施**：
1. 创建本配置文档
2. 添加服务器启动时的配置验证
3. 添加产品数量健康检查

## 联系方式

如有配置相关问题，请联系：
- 技术负责人：[待填写]
- 项目经理：[待填写]

---

**最后更新**：2026-01-29
**文档版本**：v1.0
**维护者**：Manus（总工程师）
